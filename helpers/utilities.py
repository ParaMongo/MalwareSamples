"""
   Copyright (c) 2019 Jack Farley
   This file is part of MalwareSamples
   Usage or distribution of this software/code is subject to the
   terms of the GNU GENERAL PUBLIC LICENSE.
   utilities.py
   ---
"""
import os
import psutil


def has_admin():
    """
    Checks if the sample has admin priviledges


    https://stackoverflow.com/questions/2946746/python-checking-if-a-user-has-administrator-privileges/10671675

    :return: Username and admin priviledges flag
    """
    try:
        # only windows users with admin privileges can read the C:\windows\temp
        temp = os.listdir(os.sep.join([os.environ.get('SystemRoot','C:\\windows'),'temp']))
    except:
        return os.environ['USERNAME'],False
    else:
        return os.environ['USERNAME'],True


def findProcessIdByName(process_name):
    '''
    Get a list of all the PIDs of a all the running process whose name contains
    the given string processName
    '''

    # Iterate over the all the running process
    for proc in psutil.process_iter():
        try:
            pinfo = proc.as_dict(attrs=['pid', 'name', 'create_time'])
            # Check if process name contains the given name string.
            if process_name.lower() in pinfo['name'].lower():
                return pinfo['pid']
        except (psutil.NoSuchProcess, psutil.AccessDenied, psutil.ZombieProcess):
            pass
